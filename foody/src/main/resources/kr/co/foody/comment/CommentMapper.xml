<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.foody.comment.CommentMapper">

<!-- 댓글 등록 -->
<insert id="insert" parameterType="kr.co.foody.comment.CommentVO">
	insert into comment (
		user_no, board_no, regdate, tablename, photo, content
	) values (
		#{user_no}, #{board_no}, now(), #{tablename}, #{photo}, #{content}
	)
</insert>

<!-- 댓글 수 조회 -->
<select id="count" parameterType="kr.co.foody.comment.CommentVO" resultType="int">
	select count(*) from comment
	where board_no = #{board_no} and tablename = #{tablename}
</select>

<!-- 전체 댓글 조회 -->
<select id="list" parameterType="kr.co.foody.comment.CommentVO" resultType="kr.co.foody.comment.CommentVO">
	select *,
		(select name from user where no=comment.user_no) as user_name
	from comment
	where board_no = #{board_no} and tablename = #{tablename}
	order by regdate desc
	limit ${startIdx}, ${pageRow}
</select>

<!-- 댓글 수정 -->
<update id="update" parameterType="kr.co.foody.comment.CommentVO">
	update comment set
		content = #{content}, updatedate = #{updatedate}
		<if test="photo != null">
			, photo = #{photo}
		</if>
	where no = #{no}
</update>

<!-- 삭제 -->
<delete id="delete" parameterType="int">
	delete from comment where no=#{no}
</delete>

</mapper>